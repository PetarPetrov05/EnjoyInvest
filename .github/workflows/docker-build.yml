- name: Build backend image
  run: docker build -t ghcr.io/${{ github.repository_owner,, }}/enjoyinvest-backend:latest ./backend

- name: Run backend migrations
  run: |
    docker run --rm \
      --network host \
      -e SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/enjoyinvest \
      -e SPRING_DATASOURCE_USERNAME=postgres \
      -e SPRING_DATASOURCE_PASSWORD=postgres \
      ghcr.io/${{ github.repository_owner,, }}/enjoyinvest-backend:latest \
      ./gradlew flywayMigrate

- name: Push backend image
  run: docker push ghcr.io/${{ github.repository_owner,, }}/enjoyinvest-backend:latest

- name: Build frontend image
  run: docker build -t ghcr.io/${{ github.repository_owner,, }}/enjoyinvest-frontend:latest ./frontend

- name: Push frontend image
  run: docker push ghcr.io/${{ github.repository_owner,, }}/enjoyinvest-frontend:latest
